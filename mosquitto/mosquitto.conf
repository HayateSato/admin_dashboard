# ============================================================================
# Eclipse Mosquitto MQTT Broker Configuration
# Privacy Umbrella Admin Dashboard
# ============================================================================

# ============================================================================
# Network Configuration
# ============================================================================

# Default MQTT port
listener 1883

# WebSocket support (optional - for web clients)
listener 9001
protocol websockets

# Note: bind_address is deprecated - connections from any IP allowed by default

# ============================================================================
# Security Configuration
# ============================================================================

# Allow anonymous connections (NO authentication)
# WARNING: For production, enable authentication and use TLS!
allow_anonymous true

# For production with authentication, uncomment and configure:
# password_file /mosquitto/config/passwd
# allow_anonymous false

# ============================================================================
# Logging Configuration
# ============================================================================

# Log types: error, warning, notice, information, subscribe, unsubscribe, all
log_type error
log_type warning
log_type notice
# log_type information  # Uncomment for more verbose logging

# Log destination: stdout, stderr, syslog, topic, file
log_dest stdout
log_dest file /mosquitto/log/mosquitto.log

# Include timestamp in log
log_timestamp true
log_timestamp_format %Y-%m-%dT%H:%M:%S

# ============================================================================
# Persistence Configuration
# ============================================================================

# Save in-memory database to disk
persistence true
persistence_location /mosquitto/data/

# Persistence file name
persistence_file mosquitto.db

# Save persistence every N seconds if changes occurred
autosave_interval 300

# ============================================================================
# Message Limits
# ============================================================================

# Maximum queued messages per client
max_queued_messages 1000

# Maximum packet size (bytes) - 256MB
max_packet_size 268435456

# ============================================================================
# Connection Limits
# ============================================================================

# Maximum number of client connections (-1 = unlimited)
max_connections -1

# ============================================================================
# Retained Messages
# ============================================================================

# Allow retained messages
retained_persistence true

# Note: max_retained_messages is not supported in Mosquitto 2.0+

# ============================================================================
# Quality of Service (QoS)
# ============================================================================

# Maximum QoS level
max_qos 2

# Upgrade QoS 0 to QoS 1 for all messages
# upgrade_outgoing_qos false

# ============================================================================
# Topic Configuration
# ============================================================================

# No topic restrictions (all topics allowed)
# For production, use ACLs to restrict topic access

# Example ACL configuration (uncomment for production):
# acl_file /mosquitto/config/acl.conf

# ============================================================================
# Bridge Configuration (Optional - for multi-broker setup)
# ============================================================================

# Uncomment to configure bridge to another broker
# connection bridge-01
# address remote-broker.example.com:1883
# topic privacy/# both 0

# ============================================================================
# WebSocket Configuration
# ============================================================================

# WebSocket protocol name
# ws_protocol mqtt

# ============================================================================
# TLS/SSL Configuration (Recommended for Production)
# ============================================================================

# Uncomment and configure for TLS/SSL encryption
# listener 8883
# cafile /mosquitto/config/ca.crt
# certfile /mosquitto/config/server.crt
# keyfile /mosquitto/config/server.key
# require_certificate false
# tls_version tlsv1.2

# ============================================================================
# Performance Tuning
# ============================================================================

# Socket buffer size (OS default if not set)
# socket_domain_bufsize 8192

# System V (SysV) parameter
sys_interval 10

# ============================================================================
# Notes for Production Deployment
# ============================================================================
# 
# 1. Enable Authentication:
#    - Create password file: mosquitto_passwd -c /mosquitto/config/passwd admin
#    - Set allow_anonymous false
#    - Uncomment password_file directive
#
# 2. Enable TLS/SSL:
#    - Generate CA certificate and server key/certificate
#    - Configure TLS listener on port 8883
#    - Update Flutter app and dashboard to use TLS
#
# 3. Configure ACLs:
#    - Create ACL file to restrict topic access per user
#    - Format: user <username> topic <permission> <topic>
#    - Example: user admin topic readwrite privacy/#
#
# 4. Logging:
#    - In production, consider logging to syslog
#    - Rotate log files regularly
#
# 5. Monitoring:
#    - Subscribe to $SYS/# topics for broker statistics
#    - Set up alerts for connection failures, message drops
#
# ============================================================================
